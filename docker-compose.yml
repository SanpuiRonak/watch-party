networks:
  watchparty-network:
    driver: bridge

services:
  app:
    build: .
    expose:
      - "${SERVER_PORT:-3000}"
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - PORT=${SERVER_PORT:-3000}
      - SERVER_PORT=${SERVER_PORT:-3000}
      - MONGO_HOST=${MONGO_HOST:-mongodb}
      - MONGO_PORT=${MONGO_PORT:-27017}
      - MONGODB_DB=${MONGODB_DB:-watchparty_prod}
      - JWT_SECRET=${JWT_SECRET:-please-change-this-in-production}
      - NEXT_PUBLIC_ORIGIN=${NEXT_PUBLIC_ORIGIN:-http://localhost:3000}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-}
      # TODO: Add MONGO_USER and MONGO_PASSWORD when re-enabling authentication
    depends_on:
      mongodb:
        condition: service_started
    networks:
      - watchparty-network

  mongodb:
    image: mongo:7
    expose:
      - "${MONGO_PORT:-27017}"
    environment:
      - MONGO_INITDB_DATABASE=${MONGODB_DB:-watchparty_prod}
      # TODO: Add MONGO_INITDB_ROOT_USERNAME and MONGO_INITDB_ROOT_PASSWORD when re-enabling authentication
    volumes:
      - mongo-data:/data/db
    networks:
      - watchparty-network

volumes:
  mongo-data:
